# Netlify configuration for ui.a11ypros.com

[build]
  # Base directory for the build
  base = "."
  # Install dependencies, build Storybook, then build Next.js app
  # Note: Move API route temporarily since static export can't handle it (we use Netlify Functions)
  command = "mv apps/web/app/api apps/web/app/api.disabled 2>/dev/null || true && yarn install && yarn build-storybook && yarn workspace @apps/web build && test -d apps/web/out && echo 'Build successful' || (echo 'Build failed' && exit 1) && mv apps/web/app/api.disabled apps/web/app/api 2>/dev/null || true"
  # Publish directory - Next.js static export (includes Storybook in public/)
  publish = "apps/web/out"

# Environment variables (set these in Netlify dashboard)
# [build.environment]
#   NODE_VERSION = "18"
#   ANTHROPIC_API_KEY = "your_key_here"

# Redirect rules - serve Storybook at /storybook
[[redirects]]
  from = "/storybook/*"
  to = "/storybook-static/:splat"
  status = 200

# Fallback for Storybook index
[[redirects]]
  from = "/storybook"
  to = "/storybook-static/index.html"
  status = 200

# Netlify Function for audit API
[[redirects]]
  from = "/api/audit"
  to = "/.netlify/functions/audit"
  status = 200

# Next.js SPA fallback for client-side routing (must be last)
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200
